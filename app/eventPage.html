<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script
      src="https://kit.fontawesome.com/12440d0edd.js"
      crossorigin="anonymous"
    ></script>
    <link
      href="bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link href="./style/style.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div class="intestation">
      <h1 class="text-center" style="margin-top: 20px">Event info</h1>
    </div>
    <div class="event-sheet bg-gradient">
      <div class="sheet-intestation"></div>
      <div class="sheet-description">
        <ul class="list-group list-group-flush" id="caratteristics"></ul>
      </div>
      <div class="control">
        <button
          class="addWishList btn btn-outline-info"
          onclick="addWishList(0)"
        >
          Add to wish list
        </button>
        <button class="buy btn btn-primary">Buy</button>
      </div>
    </div>

    <script type="text/html" id="event-img">
      <img src="image/%img_src%" class="img-fluid event-image" />
    </script>

    <script src="script/jquery.js" crossorigin="anonymous"></script>
    <script
      src="bootstrap/js/bootstrap.bundle.js"
      crossorigin="anonymous"
    ></script>
    <script>
      const url = new URL(window.location.href);
      const img = $("#event-img").text();
      let eventTitle = "";
      if (!url.searchParams.get("event")) {
        window.location.href = `${url.origin}/esercizi/tesina/app/userPage.php`;
      } else {
        eventTitle = url.searchParams.get("event");
      }

      console.log(eventTitle);

      const jsUcfirst = (string) => {
        return string.charAt(0).toUpperCase() + string.slice(1);
      };

      const like = () => {
        //<i class="fas fa-heart"></i>
        console.log("like");
      };

      $(document).ready(() => {
        fetch(
          `${url.origin}/esercizi/tesina/app/api/event/addWishLikeList_exist.php?title=${eventTitle}`
        )
          .then((res) => res.json())
          .then((res) => {
            if (res.status == "success") {
              $(".sheet-intestation").prepend(
                `<h2 class="text-light text-center">${eventTitle}</h2><h2 class="text-light like"><a href="#" onclick="addWishList(1)"><i class="fa-heart ${
                  res.message == "not exist" ? "far" : "fas"
                }" id="hearth"></i></a></h2>`
              );
            }
          })
          .catch((err) => {
            console.log(err);
          });

        fetch(
          `${url.origin}/esercizi/tesina/app/api/event/getOne.php?title=${eventTitle}`
        )
          .then((res) => res.json())
          .then((res) => {
            if (res.status == "success") {
              console.log(res.data);
              delete res.data.id_type;
              delete res.data.id_genre;
              delete res.data.id;
              console.log(res.data);

              for (key of Object.keys(res.data)) {
                if (key != "img_src") {
                  $("#caratteristics").append(
                    `<li class="list-group-item bg-transparent text-light">${jsUcfirst(
                      key
                    )}: ${res.data[key]}</li>`
                  );
                }
              }
              $(".sheet-description").append(
                img.replace("%img_src%", res.data.img_src)
              );
            } else {
              console.log(res.message);
            }
          });
      });

      const addWishList = async (num) => {
        const classe = $("#hearth").attr("class").split(" ")[1];
        console.log(classe);
        if (num == 1) {
          if (classe == "far") {
            $("#hearth").removeClass("far").addClass("fas");
          } else {
            $("#hearth").removeClass("fas").addClass("far");
          }
        }

        const Res = await fetch(
          `${url.origin}/esercizi/tesina/app/api/event/addWishLikeList_exist.php?title=${eventTitle}&case=${num}`
        );
        const res = await Res.json();

        alert(`${res.status} : ${res.message}`);
      };

      //TODO:
      //event sheet
    </script>
  </body>
</html>
